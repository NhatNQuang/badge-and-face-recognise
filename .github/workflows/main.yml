name: Verify SSH Key

on:
  workflow_dispatch:

jobs:
  verify:
    runs-on: ubuntu-24.04
    steps:
    - name: Check key format
      run: |
        echo "${{ secrets.VM_SSH_KEY }}" | base64 -d | head -n1
        echo "${{ secrets.VM_SSH_KEY }}" | base64 -d | tail -n1
        
    - name: Test SSH
      run: |
        mkdir -p ~/.ssh
        echo "${{ secrets.VM_SSH_KEY }}" | base64 -d > ~/.ssh/key
        chmod 600 ~/.ssh/key
        ssh -i ~/.ssh/key -o StrictHostKeyChecking=no \
          ${{ secrets.VM_USERNAME }}@${{ secrets.VM_HOST }} "echo 'âœ… SSH Works!'"
